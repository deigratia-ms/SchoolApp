{% extends 'base.html' %}

{% block title %}Parent Details - {{ parent.user.get_full_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Parent Details</h1>
    <div class="btn-group">
      <a href="{% url 'users:parent_management' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Parents
      </a>
      <a href="{% url 'users:edit_user' parent.user.id %}" class="btn btn-primary">
        <i class="fas fa-edit me-2"></i>Edit Parent
      </a>
      <a href="{% url 'users:link_parent_to_child' %}?parent_id={{ parent.id }}" class="btn btn-info">
        <i class="fas fa-link me-2"></i>Link to Children
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4">
      <div class="card shadow-sm mb-4">
        <div class="card-body text-center">
          {% if parent.user.profile_picture %}
            <img src="{{ parent.user.profile_picture.url }}" alt="{{ parent.user.get_full_name }}" class="rounded-circle mb-3" width="150" height="150">
          {% else %}
            <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width:150px;height:150px;">
              <span style="font-size:48px;">{{ parent.user.first_name|first }}{{ parent.user.last_name|first }}</span>
            </div>
          {% endif %}
          <h4 class="mb-1">{{ parent.user.get_full_name }}</h4>
          <span class="badge bg-info">{{ parent.relationship }}</span>
        </div>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header"><strong>Contact</strong></div>
        <div class="card-body">
          <div class="mb-2"><span class="fw-bold">Email:</span> {{ parent.user.email }}</div>
          <div class="mb-2"><span class="fw-bold">Phone:</span> {{ parent.user.phone_number|default:"Not provided" }}</div>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card shadow-sm mb-4">
        <div class="card-header"><strong>Account</strong></div>
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-sm-4 fw-bold">Username:</div>
            <div class="col-sm-8">{{ parent.user.username }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-sm-4 fw-bold">Status:</div>
            <div class="col-sm-8">
              {% if parent.user.is_active and parent.user.is_verified %}
                <span class="badge bg-success px-3 py-2">Active</span>
              {% elif parent.user.is_active and not parent.user.is_verified %}
                <span class="badge bg-warning px-3 py-2">Unverified</span>
              {% else %}
                <span class="badge bg-secondary px-3 py-2">Inactive</span>
              {% endif %}
            </div>
          </div>
          <div class="row mb-2">
            <div class="col-sm-4 fw-bold">Date Joined:</div>
            <div class="col-sm-8">{{ parent.user.date_joined|date:"F j, Y" }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-sm-4 fw-bold">Last Login:</div>
            <div class="col-sm-8">{% if parent.user.last_login %}{{ parent.user.last_login|date:"F j, Y, g:i a" }}{% else %}Never{% endif %}</div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header"><strong>Children</strong></div>
        <div class="card-body">
          {% if parent.children.all %}
            <div class="list-group">
              {% for child in parent.children.all %}
                <div class="list-group-item d-flex align-items-center">
                  <span class="badge bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width:35px;height:35px;">{{ child.user.first_name|first }}</span>
                  <div class="flex-fill">
                    <div class="fw-bold">{{ child.user.get_full_name }}</div>
                    <div class="small text-muted">
                      <span class="me-2">ID: {{ child.student_id }}</span>
                      <span>Grade {{ child.grade }}{% if child.section %} - {{ child.section }}{% endif %}</span>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="alert alert-light mb-0">
              <p class="text-muted mb-2">No children linked to this parent.</p>
              <a href="{% url 'users:link_parent_to_child' %}?parent_id={{ parent.id }}" class="btn btn-sm btn-primary">
                <i class="fas fa-link me-2"></i>Link to Children
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
